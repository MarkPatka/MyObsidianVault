Прежде чем понять, что такое обнаружение сервисов (Service Discovery), рассмотрим, зачем оно нужно в микросервисах.

#### Проблема

Представьте, что вы пишете микросервисы. В компании принята архитектура микросервисов: есть Address Service, Employee Service, Course Service, Student Service и т. п. У вас много Spring Boot приложений, развернутых на разных серверах, и их может быть тысячи. Например, Course Service хочет подключиться к Address Service, Student Service — к Course Service, чтобы получить данные по курсу. Как эти серверы будут общаться друг с другом? Обычно через REST-вызовы. Но сложность в том, что перед подключением один сервис должен знать IP-адрес и порт, на которых запущено другое приложение.

![[service_discovery_registry_1.webp]]


Управлять этим при тысячах приложений непросто. Как вы будете управлять IP-адресами и номерами портов? Каждый сервис, запрашивая данные у другого, должен знать его IP и адрес сервера — при большом количестве модулей и развертываний это становится критически сложной задачей. В монолите был один сервер, и его IP/порт можно было запомнить, но после разделения на множество приложений как это отслеживать? Для решения этой проблемы существуют механизмы Service Discovery и Service Registry.
#### Что такое **Service Discovery** и **Service Registry** в микросервисах?

Предположим, есть Service-A и Service-B, а балансировщик нагрузки размещён на отдельном сервере. Вводим **Discovery Service (службу обнаружения)**. Когда Service-A и Service-B запускаются, они регистрируются в Discovery Service. Эта служба хранит информацию о IP и портах Service-A и Service-B. Если у Service-B несколько инстансов, каждый из них регистрирует свои данные в Discovery Service. 
Таким образом, это центральное место, где управляется информация о хостах и портах. Этот процесс называют регистрацией — сервисы при старте регистрируются в службе обнаружения, которая хранит их данные в карте, списке или базе данных. Это и есть **Service Registry (реестр сервисов)**.

![[service_discovery_registry_2.webp]]
#### Service Registry (Реестр сервисов)

**Service Registry** — ключевая часть идентификации сервисов. Это база данных, содержащая сетевые адреса экземпляров сервисов. Реестр должен быть высокодоступным и актуальным. В реестре могут храниться, например, четыре инстанса Service-B с их IP и портами, и один инстанс Service-A.

![[service_discovery_registry_3.webp]]

#### Балансировщик нагрузки

Когда Service-A хочет подключиться к Service-B, балансировщик при получении запроса обращается к службе обнаружения: «Какие инстансы доступны для Service-B?» Получив список, балансировщик выбирает один из инстансов (например, тот, у которого меньшая нагрузка) и перенаправляет запрос туда, чтобы распределить нагрузку.

![[service_discovery_registry_4.webp]]
